<!doctype html>
<html lang="en" class="h-full" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}Mood Journal{% endblock %}</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root {
      /* From app.py via context_processor (accent colors etc.) */
      --mj-accent: {{ current_theme.accent }};
      --mj-accent-soft: {{ current_theme.accent_soft }};
      --mj-bg: {{ current_theme.bg }};
      --mj-bg-soft: {{ current_theme.bg_soft }};
      --mj-card: {{ current_theme.card }};
    }

    /**********************
     * DARK MODE (default)
     **********************/
    body {
      background-color: rgb(var(--mj-bg));
      color: #e5e7eb; /* slate-200 */
    }

    .mj-shell {
      background:
        radial-gradient(circle at top left,
          rgba(var(--mj-accent-soft), 0.2),
          transparent 55%);
      min-height: 100vh;
    }

    .mj-card {
      background-color: rgb(var(--mj-card));
      border-color: rgba(15, 23, 42, 0.9);
    }

    .mj-card-soft {
      background-color: rgb(var(--mj-bg-soft));
      border-color: rgba(15, 23, 42, 0.6);
    }

    .mj-accent-badge {
      background-color: rgba(var(--mj-accent-soft), 0.5);
      color: #020617;
    }

    .mj-accent-pill {
      background-color: rgba(var(--mj-accent), 0.15);
      color: #e5e7eb;
    }

    .mj-accent-btn {
      background-color: rgb(var(--mj-accent));
      color: #f9fafb;
    }

    .mj-accent-btn:hover {
      background-color: rgba(var(--mj-accent), 0.9);
    }

    .mj-accent-border {
      border-color: rgba(var(--mj-accent-soft), 0.9);
    }

    /* Dialog backdrop styling */
    dialog::backdrop {
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
    }

    /* Ensure dialog modal styling */
    dialog.modal {
      background: transparent;
      border: none;
      padding: 0;
    }

    dialog.modal[open] {
      animation: fadeIn 0.2s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes float {
      0% { transform: translateY(0) rotate(0); }
      50% { transform: translateY(-10px) rotate(4deg); }
      100% { transform: translateY(0) rotate(0); }
    }
    .float-animation {
      animation: float 4s ease-in-out infinite;
    }

    button,
    a {
      transition:
        background-color 0.18s ease,
        color 0.18s ease,
        border-color 0.18s ease,
        transform 0.18s ease;
    }

    button:hover,
    a.mj-accent-btn:hover {
      transform: translateY(-0.5px);
    }

    .mj-accent-btn {
      background-color: rgb(var(--mj-accent));
      color: #f9fafb;
    }

    .mj-accent-btn:hover {
      background-color: rgb(var(--mj-accent));
      filter: brightness(1.03);
    }

    /**********************
     * LIGHT MODE OVERRIDES
     * (via [data-theme="light"])
     **********************/
    [data-theme="light"] body {
      background-color: #f3f4f6; /* slate-100 */
      color: #0f172a; /* slate-900 */
    }

    [data-theme="light"] .mj-shell {
      background:
        radial-gradient(circle at top left,
          rgba(var(--mj-accent-soft), 0.25),
          transparent 55%);
    }

    [data-theme="light"] .mj-card {
      background-color: #ffffff;
      border-color: rgba(148, 163, 184, 0.7); /* slate-400 */
    }

    [data-theme="light"] .mj-card-soft {
      background-color: #f9fafb; /* slate-50 */
      border-color: rgba(148, 163, 184, 0.5);
    }

    [data-theme="light"] header {
      background-color: rgba(255, 255, 255, 0.9);
      border-color: rgba(148, 163, 184, 0.6);
    }

    [data-theme="light"] .mj-accent-pill {
      color: #0f172a;
    }

    [data-theme="light"] .mj-accent-badge {
      color: #0f172a;
    }

    /* Make "dark-text" tailwind utilities readable on light bg */
    [data-theme="light"] .text-slate-50,
    [data-theme="light"] .text-slate-100,
    [data-theme="light"] .text-slate-200 {
      color: #0f172a !important; /* slate-900 */
    }

    [data-theme="light"] .text-slate-300,
    [data-theme="light"] .text-slate-400 {
      color: #4b5563 !important; /* slate-600 */
    }

    [data-theme="light"] .text-slate-500,
    [data-theme="light"] .text-slate-600 {
      color: #6b7280 !important; /* slate-500 */
    }

    [data-theme="light"] .bg-slate-900,
    [data-theme="light"] .bg-slate-900\/60,
    [data-theme="light"] .bg-slate-900\/70,
    [data-theme="light"] .bg-slate-950\/80 {
      background-color: #ffffff !important;
    }

    [data-theme="light"] .bg-slate-800,
    [data-theme="light"] .bg-slate-700 {
      background-color: #e5e7eb !important; /* slate-200 */
    }

    [data-theme="light"] .border-slate-800,
    [data-theme="light"] .border-slate-800\/70,
    [data-theme="light"] .border-slate-700 {
      border-color: rgba(148, 163, 184, 0.7) !important;
    }

    [data-theme="light"] .bg-slate-900.rounded-full {
      background-color: #e5e7eb !important;
    }

    /* Danger (rose) + success (emerald) look ok on light bg */
    [data-theme="light"] .bg-rose-900\/40 {
      background-color: rgba(248, 113, 113, 0.12) !important;
    }
    [data-theme="light"] .bg-emerald-900\/40 {
      background-color: rgba(16, 185, 129, 0.12) !important;
    }
  </style>

  <script>
    // Modal helpers
    function openModal(id) {
      const el = document.getElementById(id);
      if (!el) return;
      el.classList.remove('hidden');
    }
    function closeModal(id) {
      const el = document.getElementById(id);
      if (!el) return;
      el.classList.add('hidden');
    }

    // ---- Dark / Light mode ----
    (function () {
      const root = document.documentElement;
      const saved = localStorage.getItem('mj-theme-mode');

      if (saved === 'light' || saved === 'dark') {
        root.setAttribute('data-theme', saved);
      }

      // Update label on load
      window.addEventListener('DOMContentLoaded', () => {
        const label = document.getElementById('modeLabel');
        const current = root.getAttribute('data-theme') || 'dark';
        if (label) {
          label.textContent = current === 'dark' ? 'Dark' : 'Light';
        }
      });
    })();

    function toggleMode() {
      const root = document.documentElement;
      const current = root.getAttribute('data-theme') || 'dark';
      const next = current === 'dark' ? 'light' : 'dark';
      root.setAttribute('data-theme', next);
      localStorage.setItem('mj-theme-mode', next);

      const label = document.getElementById('modeLabel');
      if (label) {
        label.textContent = next === 'dark' ? 'Dark' : 'Light';
      }
    }
  </script>

  {% block extra_head %}{% endblock %}
</head>
<body>
  <div class="mj-shell">
    <div class="min-h-screen flex flex-col">
      <!-- Header -->
      <header class="border-b border-slate-800/70 bg-slate-900/70 backdrop-blur">
        <div class="max-w-6xl mx-auto px-4 py-3 flex flex-wrap items-center justify-between gap-3">
          <div class="flex items-center gap-3">
            <div class="w-9 h-9 rounded-xl flex items-center justify-center mj-accent-btn text-white text-lg font-bold shadow">
              MJ
            </div>
            <div>
              <a href="{{ url_for('index') }}" class="text-sm font-semibold text-slate-50">
                Mood Journal â€” Demo
              </a>
              <p class="text-[11px] text-slate-400">
                Track your moods, tags, and trends over time.
              </p>
            </div>
          </div>

          <div class="flex items-center gap-4">
            <nav class="flex items-center gap-2 text-xs sm:text-sm">
              <a href="{{ url_for('index') }}"
                 class="px-2 py-1 rounded-lg border border-slate-700 text-slate-200 hover:text-white hover:border-slate-500">
                Dashboard
              </a>
              <a href="{{ url_for('calendar_view') }}"
                 class="px-2 py-1 rounded-lg border border-slate-700 text-slate-200 hover:text-white hover:border-slate-500">
                Calendar
              </a>
              <a href="{{ url_for('mood_graph', mode='line') }}"
                 class="px-2 py-1 rounded-lg border border-slate-700 text-slate-200 hover:text-white hover:border-slate-500">
                Mood Graph
              </a>
              <a href="{{ url_for('emoji_groups') }}"
                 class="px-2 py-1 rounded-lg border border-slate-700 text-slate-200 hover:text-white hover:border-slate-500">
                Emoji Groups
              </a>
              <button onclick="openModal('clearDataModal')"
                      class="px-2 py-1 rounded-lg border border-rose-700 text-rose-200 hover:text-rose-100 hover:border-rose-500">
                Clear Data
              </button>
            </nav>

            <!-- Right side: Theme picker + Dark/Light toggle -->
            <div class="flex items-center gap-3">
              <!-- Dark / Light toggle -->
              <button type="button"
                      onclick="toggleMode()"
                      class="px-2 py-1 rounded-lg border border-slate-700 text-slate-200 hover:text-white hover:border-slate-500 text-xs flex items-center gap-1">
                <span id="modeLabel">Dark</span>
                <span>mode</span>
              </button>

              <!-- Color theme picker (your existing theme system) -->
              <form method="post" action="{{ url_for('set_theme') }}"
                    class="flex items-center gap-2 text-xs">
                <label for="theme" class="text-slate-400 hidden sm:inline">Theme</label>
                <select id="theme" name="theme"
                        class="bg-slate-900/70 border border-slate-700 rounded-lg px-2 py-1 text-xs text-slate-100">
                  {% for key, t in theme_choices.items() %}
                    <option value="{{ key }}" {% if key == current_theme_key %}selected{% endif %}>
                      {{ t.label }}
                    </option>
                  {% endfor %}
                </select>
                <button class="mj-accent-btn px-2 py-1 rounded-lg text-[11px]" type="submit">
                  Apply
                </button>
              </form>
            </div>
          </div>
        </div>
      </header>

      <!-- Flash messages -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="max-w-6xl mx-auto px-4 mt-4 space-y-2">
            {% for category, msg in messages %}
              <div class="rounded-lg px-4 py-3 text-xs sm:text-sm border
                          {% if category == 'success' %}
                            bg-emerald-900/40 text-emerald-100 border-emerald-500/60
                          {% else %}
                            bg-rose-900/40 text-rose-100 border-rose-500/60
                          {% endif %}">
                {{ msg|safe }}
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <!-- Main content -->
      <main class="flex-1 max-w-6xl mx-auto px-4 py-6">
        {% block content %}{% endblock %}
      </main>

      {% block modals %}{% endblock %}

      {% block extra_scripts %}{% endblock %}
    </div>
  </div>
</body>
</html>
